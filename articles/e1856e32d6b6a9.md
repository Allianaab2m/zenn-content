---
title: "DiscordRichPrecenseã‚’iOSã§ã‚‚åˆ©ç”¨ã™ã‚‹"
emoji: "ðŸŽ®"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Discord", "iOS"]
published: false
---
ã“ã†ã‚„ã£ã¦æ–‡ç« ã‚’æ›¸ãã®ã¯åˆã‚ã¦ãªã®ã§ï¼Œé–“é•ã£ã¦ã„ã‚‹ç‚¹ãªã©ãŒã‚ã‚Œã°ã”æŒ‡æ‘˜ãŠé¡˜ã„ã—ã¾ã™ã€‚

# å‰ç½®ã

PCç‰ˆã®Discordã«ã¯è‡ªåˆ†ã®ã—ã¦ã„ã‚‹ã‚²ãƒ¼ãƒ ãªã©ã®æƒ…å ±ã‚’ã“ã®ã‚ˆã†ã«ã—ã¦è¡¨ç¤ºã™ã‚‹ã“ã¨ãŒå‡ºæ¥ã‚‹æ©Ÿèƒ½ãŒã‚ã‚Šã¾ã™ã€‚
[ç”»åƒ]
ã“ã®æ©Ÿèƒ½ã‚’RichPrecense(ç•¥ã—ã¦RPC)ã¨è¨€ã„ã¾ã™ã€‚
ç§ã¯æ™®æ®µã‚²ãƒ¼ãƒ ã‚’iPadã§ã—ã¾ã™ãŒï¼Œæ®‹å¿µãªãŒã‚‰iOSã«ã¯éžå¯¾å¿œã€‚
ãã“ã§ï¼Œã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã‚¢ãƒ—ãƒªã‚„PCã‚’æ´»ç”¨ã—ï¼ŒRichPrecenseã‚’å®Ÿç¾ã—ã¾ã—ãŸã€‚

# ç”¨æ„ã™ã‚‹ã‚‚ã®

- iOSç«¯æœ«
- sshçµŒç”±ã§ã‚³ãƒžãƒ³ãƒ‰ã‚’å®Ÿè¡Œã§ãã‚‹PC
  - WSLã§ã¯è©¦ã—ã¦ã„ã¾ã›ã‚“ã€‚
  - ç­†è€…ã¯Kubuntu 20.04ã‚’ä½¿ã£ã¦ã„ã¾ã™ã€‚
- Node.js v16.13.0
- é©å½“ãªã‚¨ãƒ‡ã‚£ã‚¿

# 1. RPCç”¨Discordã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ä½œæˆ

RPCã‚’åˆ©ç”¨ã™ã‚‹ã«ã¯ï¼Œ[DiscordDeveloperPortal](https://discord.com/developers/applications)ã‚’åˆ©ç”¨ã—ï¼Œã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½œæˆã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
å³ä¸Šã®NewApplicationã‹ã‚‰åå‰ã‚’æ±ºã‚ï¼Œç™»éŒ²ã—ã¾ã™ã€‚
ã“ã®ã¨ãã«æŒ‡å®šã—ãŸåå‰ã¯ï¼Œå®Ÿéš›ã«è¡¨ç¤ºã•ã‚Œã‚‹RPCã®ã“ã®éƒ¨åˆ†ã«ãªã‚Šã¾ã™ã€‚
[ç”»åƒ]
ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³åã¯APIã‹ã‚‰æ“ä½œã§ããªã„ã‚ˆã†ãªã®ã§ï¼Œèµ·å‹•ã—ãŸiOSã‚¢ãƒ—ãƒªã”ã¨ã«è¡¨ç¤ºã‚’å¤‰ãˆãŸã„å ´åˆã¯ï¼Œãã‚Œãžã‚Œã«ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½œæˆã—ãªã‘ã‚Œã°ãªã‚Šã¾ã›ã‚“ã€‚
ä½œæˆãŒå‡ºæ¥ãŸã‚‰ï¼Œå·¦ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰OAuth2ã‚’é¸æŠžã—ï¼ŒClientIDã‚’æŽ§ãˆã¦ãã ã•ã„ã€‚

# 2. RPCã‚’é€ä¿¡ã™ã‚‹ã‚³ãƒ¼ãƒ‰ã‚’ä½œæˆ
DiscordRPCã®APIãƒ©ãƒƒãƒ‘ã‚’åˆ©ç”¨ã—ã¾ã™ã€‚ä»Šå›žã¯JavaScriptã®[discord-rpc](https://www.npmjs.com/package/discord-rpc)ã‚’åˆ©ç”¨ã—ã¾ã™ã€‚
ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã‚’ã‚³ãƒ”ãƒ¼ãƒšãƒ¼ã‚¹ãƒˆã—ã¦ãã ã•ã„ã€‚
```js
const DiscordRpc = require('discord-rpc')
const rpc = new DiscordRpc.Client({ transport: 'ipc' })
const config = require('./config.json')
const clientId = 'æŽ§ãˆãŸClientID'
DiscordRpc.register(clientId)
const startAt = Math.floor(Date.now() / 1e3)

rpc.login({clientId: clientId}).catch(console.error)

const updateRPC = () => {
   const rpcActivity = {
      details: 'hoge',
      state: 'fuga',
      startTimestamp: startAt
   }
   rpc.setActivity(rpcActivity)
}

rpc.on('ready', () => {
   console.log('ready')
   updateRPC()
})
```